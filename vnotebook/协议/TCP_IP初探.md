# TCP_IP初探
**TCP/IP**的全称是**Transmission Control Protocol/Internet Protocol**，中译名为**传输控制协议/因特网互联协议**，又名**网络通讯协议**，是**Internet**最基本的协议、**Internet**国际互联网络的基础，由**网络层**的**IP协议**和**传输层**的**TCP协议**组成。**TCP/IP**定义了电子设备如何连入因特网，以及数据如何在它们之间传输的标准。协议采用了**4层**的层级结构，每一层都呼叫它的下一层所提供的协议来完成自己的需求。

通俗而言：**TCP**负责发现传输的问题，一有问题就发出信号，要求重新传输，直到所有数据安全正确地传输到目的地。而**IP**是给因特网的每一台联网设备规定一个地址。

**TCP/IP**是一组通信协议的代名词，是由一系列协议组成的协议簇。它本身指两个协议集：

* TCP 传输控制协议
* IP    互联网络协议

## 组成

![](https://github.com/Anthem9/vnote/raw/master/vnotebook/%E5%8D%8F%E8%AE%AE/_v_images/_1525345982_3895.png)

当数据在网路中传输的时候，会依次进过每一层，最终呈现给用户

## TCP/IP体系和协议栈之间的关系

![](https://github.com/Anthem9/vnote/raw/master/vnotebook/%E5%8D%8F%E8%AE%AE/_v_images/_1525346196_27548.png)

我们可以看出，我们熟知的**DNS**，**FTP**等等协议，都是在应用层上的协议，下面我用FTP做例子讲解这个**从上到下**又**从下到上**的过程

### 基于TCP/IP的文件传输协议(FTP)

![](https://github.com/Anthem9/vnote/raw/master/vnotebook/%E5%8D%8F%E8%AE%AE/_v_images/_1525346229_31122.png)

原始数据在应用层加上了一个**FTP头**之后，在传输层加上了**TCP头**，依次类推，到达目的之后，又**反方向**脱去数据头，最终呈现原始的数据

## 数据链路层协议

这里我们稍微了解一下数据链路层协议

### SLIP
全称是**Serial Line IP**，它是一种在串行线路上对**IP**数据报进行封装的简单形式 

### PPP
点对点协议修改了**SLIP**协议中的所有缺陷，与**SLIP**类似，**PPP**经常用于低速的串行链路

## 网络层IP协议

网际协议(**IP**)主要负责在主机之间寻址和选择数据包的路由，**IP**协议不含错误恢复的编码，属于不可靠的协议

## MAC地址
**MAC**地址是网路设备在出厂之前由厂家写入到硬件中的一个地址

当我们的设备接入网络之后，计算机会使用**ARP协议**来建立**IP地址**和**MAC地址**的映射表

为什么讲这个，**ARP攻击**的原理就是从这里引伸出来的

## IP地址的分类

**IP地址**划分为**A、B、C**3类

由**InternetNIC**在全球范围内统一分配，**D、E**类为特殊地址（组播和广播）

### A类IP地址
一个**A类IP地址**由**1字节**的网络地址和**3字节**主机地址组成，网络地址的最高位必须是0

地址范围从**0.0.0.0** 到**127.255.255.255**

可用的**A类网络**有**126**个，每个网络能容纳**1亿多**个主机

A类的**私有IP**为

**10.0.0.0** 到 **10.255.255.255**

### B类IP地址
一个**B类IP地址**由**2个字节**的网络地址和**2个字节**的主机地址组成，网络地址的最高位必须是10

地址范围从**128.0.0.0**到**191.255.255.255**

可用的**B类网络**有**16382**个，每个网络能容纳**6万多**个主机 。 

B类的**私有IP**为

**172.16.0.0 **到 **172.31.255.255**

### C类IP地址
一个**C类IP地址**由**3字节**的网络地址和**1字节**的主机地址组成，网络地址的最高位必须是110

范围从**192.0.0.0**到**223.255.255.255**，**C类网络**可达**209万余**个，每个网络能容纳**254**个主机。 

C类的**私有IP**为

**192.168.0.0 **到 **192.168.255.255**

现在我们大多数的**家庭路由器**都是工作在这个段里面

那么一个网络设备是如何能被其他网络设备发现的呢？

对于这么几个地址，做到**知道**并能**区别**

## ARP

**ARP**把基于**TCP/IP**软件使用的**IP地址**解析成局域网硬件使用的媒体访问控制(**MAC地址**)地址

## 互连网控制报文协议ICMP
**ICMP**传递差错报文以及其他需要注意的信息

**ICMP**报文通常被网络层或更高层协议(**TCP**或**UDP**)使用，一些**ICMP**报文把差错报文返回给用户进程

**ICMP**用来传送一些关于网络和主机的控制信息，如目标主机是不可到达的、路由的重定向等

常用的**ping**命令就是使用了**ICMP**协议，**ICMP**不为数据提供错误控制服务，只是报告数据出错并不再传送错误的数据，并在**IP数据报**的生存期过后将期抛弃

## 传输层协议
传输层包括两个协议：

第一个是**TCP协议**，即传输控制协议，是一个可靠的、面向连接的协议

第二个是**UDP协议**，它采用无连接的方式，不管发送的数据包是否到达目的主机，数据包是否出错，收到数据包的主机也不会告诉发送方是否正确收到了数据，它的可靠性是由上层协议来保障的

### TCP协议

传输控制协议**TCP**将数据分成数据报，用能够到达目的地的路径信息连行包装,接收端则将这些数据进行重组。它提供可靠的、面向连接的数据报传递服务

### UDP协议

用户数据报协议**UDP**是无连接的服务，在无连接服务的情况下，两个实体之间的通信不需先建立好一个连接，因此其下层的有关资源不需要事先进行预定保留，这些资源将在数据传输时动态地进行分配

## 端口

**传输层**就是通过**协议端口**(**protocol port**，简称**端口**)与**应用层**的应用程序进行信息交互的，应用层各种用户进程通过相应的端口与传输层实体进行信息交互

**端口**实际上是一个**16bit**长的地址，范围可以从**0**至**65535**

将**0**至**1023**端口号称为**熟知端口**(**Well-Known Port**)，其余**1024**至**65535**端口号称为**一般端口**或**动态连接端口**(**Registered/Dynamic**)

在数据传输过程中，应用层中的各种不同的服务器进程不断地检测分配给它们的端口，以便发现是否有某个应用进程要与它通信。

## TCP三次握手
![](https://github.com/Anthem9/vnote/raw/master/vnotebook/%E5%8D%8F%E8%AE%AE/_v_images/_1525348817_4797.png)

## TCP四次挥手
![](https://github.com/Anthem9/vnote/raw/master/vnotebook/%E5%8D%8F%E8%AE%AE/_v_images/_1525348832_13378.png)

TCP/IP是全双工的，每个方向都必须单独进行关闭。

上图中1和3没有先后顺序，在2和3之间服务器仍可以向客户端发送数据，客户端此时只能接收数据，而不能发送数据。




