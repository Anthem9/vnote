# 蓝鲸文件管理系统wp
![1](_v_images/_1_1523261937_9730.jpg)
![2](_v_images/_2_1523262261_18574.jpg)
![3](_v_images/_3_1523262290_3843.jpg)

![4](_v_images/_4_1523262302_13831.jpg)
![5](_v_images/_5_1523262363_961.jpg)
![6](_v_images/_6_1523262377_31859.jpg)
![7](_v_images/_7_1523262416_11816.jpg)
![8](_v_images/_8_1523262427_16729.jpg)
![9](_v_images/_9_1523262446_23498.jpg)
第一次进数据库由于转义不会注入

![10](_v_images/_10_1523262466_27034.jpg)
![](_v_images/_1523262471_23859.jpg)
数据从数据库中提取出来时转义消失，产生二次注入
![](_v_images/_1523262477_19965.jpg)
![](_v_images/_1523262480_28879.jpg)
![](_v_images/_1523262486_24824.jpg)
![](_v_images/_1523262728_7696.jpg)

![](_v_images/_1523262760_14273.jpg)
![](_v_images/_1523262770_19125.jpg)
更新语句是用fid字段进行定位的，在rename.php的oldname字段中输入',extension='',filename='x.jpg由于转义并不能起到注入的效果，但能找到fid使注入成功，真正起到注入效果的是网站第一次报错的文件名（不包括后缀）
![](_v_images/_1523262814_25444.jpg)
注入成功后，数据库认为这个文件的拓展名为空，所以文件系统中为x.jpg.jpg，而数据库认为文件名为x.jpg


![](_v_images/_1523262952_1346.jpg)
上传完成后，文件系统有x.jpg.jpg和x.jpg两个文件，而数据库中储存了，文件名为x.jpg拓展名为空的文件和文件名为x拓展名为.jpg的文件
重新命名时，数据库查询文件名为x.jpg的文件，并发现其拓展名为空，进而在文件系统查询x.jpg，找到我们第二次上传的木马，然后修改文件名
![](_v_images/_1523262964_31221.jpg)

![](_v_images/_1523262971_4905.jpg)