# 第二章-核心防御机制
## 处理用户访问
用户一般分为：
* 匿名用户
* 一般用户
* 管理员用户

处理用户访问的安全机制：
* 身份验证
* 会话管理
* 访问控制
上述机制相关联，任何一个地方出问题，都可能使攻击者自由访问应用程序的数据和功能。
### 身份验证
验证用户是指确定用户的真实身份，也就是权限是匿名用户，一般用户还是管理员用户。
有以下几种方式：
* 口令验证
* 证书
* 质询-响应令牌
### 会话管理
* 会话本身是一组保存在服务器上的数据结构，用于追踪用户与应用程序的交互状态。
* 令牌是一个唯一的字符串，应用程序将其映射到会话中。
* 当用户收到一个令牌时，浏览器会在随后的HTTP请求中将他返回给服务器，帮助应用程序将请求与该用户联系起来。
* 如果令牌被攻破，攻击者就可以伪装成被攻破的用户，像已经通过验证的用户一样使用应用程序。
* 令牌生成过程中存在的缺陷是主要的漏洞来源，使攻击者能够推测出发布给其他用户的令牌
* 随后，攻击者再利用令牌中的缺陷来截获其他用户的令牌。
### 访问控制
* 应用程序可支持无数不用的用户角色，每种角色都拥有特定的权限，每名用户只允许访问应用程序的部分数据。
* 由于典型访问控制的要求相当复杂，因此这种机制中一般存在大量安全漏洞，使得攻击者能够获得对应用程序数据与功能的未授权访问
* 第八章详细讲
## 处理用户输入
### 输入的多样性

### 输入的处理方法
#### 黑名单
#### 白名单
#### 净化/转义
* 数据中可能存在的恶意字符被彻底删除掉，只留下已知的安全的字符，或者在进一步处理前对它们进行适当编码或“转义”
* 在许多情况下，可将数据净化作为处理恶意输入的通用解决办法。
* 如果要防范多种恶意输入，就要采用边界确认的办法进行数据净化（比如既要防XSS又要防止SQL注入）
#### 安全数据处理
* 有些时候，可使用安全的编程方法避免常见问题
* 例如，在数据库访问过程中正确使用参数化查询，就可以避免SQL注入攻击
* 第九章详细讲
* 不是普适的方法，但很有效

### 边界确认
* 服务器端应用程序的每一个单独的组件或功能单元将其输入当作来自潜在恶意来源的输入对待。
* 除客户端与服务器之间的外部边界外，应用程序在上述每一个信任边界上执行数据确认。
* 每个组件都可以防御它收到的特殊类型的专门设计的输入。


## 处理攻击者
### 处理错误
* 在生产环境下，应用程序不应在其响应中返回任何系统生成的消息或其他调试信息。
### 维护审计日志
* 保护不严密的审计日志可能为攻击者提供大量信息，如会话令牌和请求参数
### 向管理员发出警报
* 遇到反常事件，发警报
### 应对攻击
* 响应变慢
* 终止攻击者会话


